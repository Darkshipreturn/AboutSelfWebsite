<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Darkshipreturn | Minigame</title>
  
  <!-- External Stylesheets -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="game.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- External Scripts -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <!-- Theme Script -->
  <script>
    const savedTheme = localStorage.getItem('theme') || 'blue';
    document.body.className = `theme-${savedTheme}`;
  </script>

  <!-- Particle Background -->
  <div id="particles-js"></div>

  <!-- Theme Controls Panel -->
  <div id="theme-controls-panel" class="theme-controls" role="region" aria-labelledby="theme-heading">
    <button id="theme-toggle-btn" class="theme-toggle" aria-controls="theme-controls-panel" aria-expanded="false" aria-label="Toggle theme controls">
      <i class="fas fa-palette"></i>
    </button>
    <h3 id="theme-heading" class="text-lg font-bold mb-4">Theme Color</h3>
    <div class="color-picker">
      <button class="color-option" style="background: #3b82f6;" data-theme="blue" aria-label="Select blue theme"><i class="fas fa-check"></i></button>
      <button class="color-option" style="background: #8b5cf6;" data-theme="purple" aria-label="Select purple theme"><i class="fas fa-check"></i></button>
      <button class="color-option" style="background: #10b981;" data-theme="green" aria-label="Select green theme"><i class="fas fa-check"></i></button>
      <button class="color-option" style="background: #ef4444;" data-theme="red" aria-label="Select red theme"><i class="fas fa-check"></i></button>
      <button class="color-option" style="background: #ec4899;" data-theme="pink" aria-label="Select pink theme"><i class="fas fa-check"></i></button>
      <button class="color-option" style="background: #f97316;" data-theme="orange" aria-label="Select orange theme"><i class="fas fa-check"></i></button>
    </div>
  </div>

  <!-- Navigation Bar -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-slate-800/90 backdrop-blur-md shadow-lg">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-3 items-center h-16">
        <div class="justify-self-start">
          <a href="index.html" class="flex items-center space-x-2 text-white hover:text-[var(--primary-color)] transition-colors">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Home</span>
          </a>
        </div>
        <div class="justify-self-center">
            <h1 class="text-xl font-bold text-white whitespace-nowrap">Browser Snake</h1>
        </div>
        <div class="justify-self-end">
          <button id="howToPlayButton" class="text-white hover:text-[var(--primary-color)] transition-colors" aria-label="How to play">
            <i class="fas fa-question-circle text-2xl"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- How to Play Modal -->
  <div id="howToPlayModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-slate-800 rounded-xl border border-slate-700 p-6 max-w-md w-full">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-white">How to Play</h2>
        <button id="closeModalButton" class="text-slate-400 hover:text-white transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="space-y-4 text-slate-300">
        <div>
          <h3 class="font-bold text-white mb-2">üéÆ Controls</h3>
          <ul class="space-y-1 text-sm">
            <li><strong>Desktop:</strong> Arrow keys to move</li>
            <li><strong>Mobile:</strong> Swipe or use on-screen buttons</li>
            <li><strong>Pause:</strong> Press Space bar</li>
          </ul>
        </div>
        <div>
          <h3 class="font-bold text-white mb-2">üìú Rules</h3>
          <ul class="space-y-1 text-sm">
            <li>üçé Eat red food to grow and score points</li>
            <li>üö´ Don't hit walls or yourself</li>
            <li>‚ö° Game speeds up as you score more</li>
            <li>üèÜ Compete for the top leaderboard spot</li>
          </ul>
        </div>
      </div>
      <button id="startGameButton" class="w-full mt-6 px-6 py-3 bg-[var(--primary-color)] hover:bg-[var(--primary-hover)] rounded-lg font-medium text-white transition-colors">
        Start Playing
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="pt-24 pb-16">
    <div class="px-4 sm:px-6 lg:px-8 max-w-xl mx-auto flex flex-col items-center">
      
      <!-- Game Container -->
      <div id="game-container" class="relative w-full">
        <canvas id="gameCanvas" class="bg-slate-900/70 rounded-lg border-2 border-slate-700"></canvas>
        
        <!-- Pause Overlay -->
        <div id="pauseOverlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm flex flex-col justify-center items-center rounded-lg hidden">
          <i class="fas fa-pause text-6xl text-white mb-4 opacity-50"></i>
          <p id="countdownNumber" class="text-6xl font-bold text-white countdown-number">PAUSED</p>
          <p id="countdownText" class="text-slate-300 mt-4 text-xl">Press Space to Resume</p>
        </div>
        
        <!-- Fullscreen Button -->
        <button id="fullscreenButton" class="fullscreen-btn"><i class="fas fa-expand"></i></button>
        
        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="absolute inset-0 bg-black/70 backdrop-blur-sm flex flex-col justify-center items-center rounded-lg p-4 text-center hidden">
          <h2 class="text-4xl font-bold text-white mb-2">Game Over</h2>
          <p class="text-lg text-slate-300 mb-1">Final Score: <span id="finalScore">0</span></p>
          <p id="highScoreMessage" class="text-sm text-[var(--primary-color)] font-bold mb-4 hidden">üéâ New High Score!</p>
          <form id="scoreForm">
              <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="10" required class="w-full bg-slate-700/50 border border-slate-600 rounded-md py-2 px-4 mb-4 text-center focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition">
              <button type="submit" class="w-full px-6 py-3 bg-[var(--primary-color)] hover:bg-[var(--primary-hover)] rounded-lg font-medium text-white transition-colors">
                Save Name & Play Again
              </button>
          </form>
          <button id="playAgainButton" class="w-full px-6 py-3 bg-[var(--primary-color)] hover:bg-[var(--primary-hover)] rounded-lg font-medium text-white transition-colors hidden">
            Play Again
          </button>
        </div>
      </div>

      <!-- Game UI -->
      <div class="w-full mt-4 flex justify-between items-center text-white">
        <div class="text-xl font-bold">
          Score: <span id="score">0</span>
          <span id="highScoreIndicator" class="text-sm text-slate-400 ml-2 hidden">(Best: <span id="currentHighScore">0</span>)</span>
        </div>
        <button id="pauseButton" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors hidden sm:flex items-center gap-2">
          <i class="fas fa-pause"></i>
          <span class="text-sm">Pause</span>
        </button>
      </div>

      <!-- Mobile Controls -->
      <div id="mobileControls" class="w-full mt-4 sm:hidden">
        <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">
          <div></div>
          <button class="control-btn" data-direction="up">
            <i class="fas fa-chevron-up"></i>
          </button>
          <div></div>
          <button class="control-btn" data-direction="left">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="control-btn" data-direction="pause">
            <i class="fas fa-pause"></i>
          </button>
          <button class="control-btn" data-direction="right">
            <i class="fas fa-chevron-right"></i>
          </button>
          <div></div>
          <button class="control-btn" data-direction="down">
            <i class="fas fa-chevron-down"></i>
          </button>
          <div></div>
        </div>
      </div>

      <!-- Personal Best Section -->
      <div class="w-full mt-8">
          <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
              <div id="personalBestDisplay" class="flex justify-between items-center">
                  <div>
                      <h3 id="playerNameDisplay" class="text-xl font-bold text-white">Guest</h3>
                      <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mt-1">Personal Best</p>
                  </div>
                  <div class="flex items-center gap-4">
                      <span id="personalBestScore" class="text-3xl font-bold text-[var(--primary-color)]">0</span>
                      <button id="editNameButton" class="text-slate-400 hover:text-white transition-colors text-lg"><i class="fas fa-pencil-alt"></i></button>
                  </div>
              </div>
              <form id="editNameForm" class="hidden">
                  <input type="text" id="editPlayerNameInput" maxlength="10" required class="w-full bg-slate-700/50 border border-slate-600 rounded-md py-2 px-4 text-white focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition">
                  <div class="flex gap-2 mt-2">
                      <button type="submit" class="flex-grow px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold text-sm">Save</button>
                      <button type="button" id="cancelEditButton" class="flex-grow px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-bold text-sm">Cancel</button>
                  </div>
              </form>
          </div>
      </div>

      <!-- Leaderboard Section -->
      <div class="w-full mt-8">
        <h2 class="text-3xl font-bold mb-4 text-center"><span class="border-b-4 border-[var(--primary-color)] pb-2">Leaderboard</span></h2>
        <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
            <ol id="leaderboardList" class="space-y-3 text-white"></ol>
            <p id="noScoresMessage" class="text-slate-400 text-center hidden">No scores yet. Be the first!</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-slate-800/90 backdrop-blur-md py-4 border-t border-slate-700">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center text-sm text-slate-400">&copy; 2025 Darkshipreturn. All rights reserved.</div>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCfDTrvR1Zae4RBrJGSD7SjTQa06KVMf6U",
      authDomain: "darkshipreturn-snake-game1.firebaseapp.com",
      projectId: "darkshipreturn-snake-game1",
      storageBucket: "darkshipreturn-snake-game1.firebasestorage.app",
      messagingSenderId: "909362495325",
      appId: "1:909362495325:web:0d381f78bda58cd85072b4",
      measurementId: "G-YBWLS7QBB8"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- External Scripts -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script src="script.js"></script>
  <script src="game.js"></script>
</body>
</html>
